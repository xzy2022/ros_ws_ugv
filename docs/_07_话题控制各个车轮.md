# ğŸï¸ æ•™ç¨‹å¤ç°æ­¥éª¤ï¼šç”¨ ROS Topic æ§åˆ¶è½¦è½®

## 1. å‡†å¤‡å·¥ä½œ

  * **å…‹éš†æˆ–ä¸‹è½½ä»£ç ï¼š**
      * è·å–æœ¬æ•™ç¨‹ç›¸å…³çš„ä»£ç ä»“åº“ï¼ˆè§†é¢‘ä¸­æåˆ°çš„æ˜¯ `cotberry/self-driving-vehicle-101`ï¼‰ã€‚
      * ç¡®ä¿ä½ çš„å·¥ä½œç©ºé—´ï¼ˆ`~/self-driving-my/ros_ws`ï¼‰ä¸­åŒ…å«æ‰€éœ€çš„ROSåŒ…ã€‚

  * **æ›´æ–°å·¥ä½œç©ºé—´æ–‡ä»¶ï¼š**
      * åœ¨ä½ çš„å°è½¦æ¨¡å‹åŒ…ï¼ˆ`car_model`ï¼‰ä¸­ï¼Œç”¨æ•™ç¨‹æä¾›çš„**07 æ–‡ä»¶å¤¹**ä¸­çš„æ–‡ä»¶è¦†ç›–åŸæœ‰çš„æ–‡ä»¶ï¼ˆåŒ…æ‹¬ `config`, `launch`, `urdf` ç­‰æ–‡ä»¶å¤¹ï¼‰ã€‚
      * **é‡è¦æ–‡ä»¶ä¿®æ”¹ï¼ˆè§†é¢‘ä¸­å¼ºè°ƒçš„ï¼‰ï¼š**
          * **`urdf/smart.urdf.xacro` (URDF æ–‡ä»¶):**
              * **æ·»åŠ  `transmission` æ¨¡å—:** ä¸ºæ¯ä¸ªè½®å­çš„ jointï¼ˆåè½®çš„é€Ÿåº¦ jointï¼Œå‰è½®çš„è½¬å‘ jointï¼‰æ·»åŠ  `transmission` æ ‡ç­¾ï¼Œå®šä¹‰å…¶ç±»å‹ï¼ˆå¦‚ `hardwareInterface/VelocityJointInterface` æˆ– `hardwareInterface/EffortJointInterface`ï¼‰å’Œæ‰§è¡Œå™¨ï¼ˆActuatorï¼‰ã€‚
              * **æ·»åŠ  Gazebo Plugins:** æ·»åŠ  `gazebo_ros_control` æ’ä»¶å’Œ `robot_state_publisher` æ’ä»¶ï¼Œç”¨äºè¿æ¥Gazeboä»¿çœŸå’ŒROSæ§åˆ¶å™¨ã€‚
              * **æ·»åŠ æ‘©æ“¦åŠ›ï¼ˆFriction Parametersï¼‰:** åœ¨ Gazebo ç›¸å…³çš„ link å±æ€§ä¸­ä¸ºè½¦è½®æ·»åŠ æ‘©æ“¦åŠ›å‚æ•°ä»¥å¢åŠ ä»¿çœŸçœŸå®æ€§ã€‚
          * **`config/smart_control.yaml` (æ§åˆ¶å™¨é…ç½®):**
              * å®šä¹‰å¹¶é…ç½®æ‰€éœ€çš„ **ROS Controllers**ï¼ŒåŒ…æ‹¬ï¼š
                  * `JointStateController` (è”åˆçŠ¶æ€æ§åˆ¶å™¨)
                  * `VelocityControllers` (åè½®é€Ÿåº¦æ§åˆ¶å™¨, `rear_right_wheel_joint`, `rear_left_wheel_joint`)
                  * `EffortControllers/JointPositionController` (å‰è½®è½¬å‘ä½ç½®æ§åˆ¶å™¨, `front_right_steering_joint`, `front_left_steering_joint`)
              * ä¸ºæ¯ä¸ªæ§åˆ¶å™¨è®¾ç½® **PID å‚æ•°**ã€‚
          * **`launch/control.launch` (å¯åŠ¨æ–‡ä»¶):**
              * åŠ è½½ `smart_control.yaml` é…ç½®æ–‡ä»¶åˆ°ROSå‚æ•°æœåŠ¡å™¨ã€‚
              * ä½¿ç”¨ `controller_manager` èŠ‚ç‚¹å¯åŠ¨ï¼ˆSpawnï¼‰å‰é¢é…ç½®çš„å„ä¸ªæ§åˆ¶å™¨ã€‚

## 2. å¯åŠ¨ Gazebo ä»¿çœŸ

1.  **æ‰“å¼€ç¬¬ä¸€ä¸ªç»ˆç«¯ï¼ŒSource å·¥ä½œç©ºé—´å¹¶å¯åŠ¨ Gazebo ç©ºä¸–ç•Œï¼š**
    ```bash
    source ~/self-driving-my/ros_ws/devel/setup.bash
    roslaunch gazebo_ros empty_world.launch
    ```
2.  **æ‰“å¼€ç¬¬äºŒä¸ªç»ˆç«¯ï¼ŒSource å·¥ä½œç©ºé—´å¹¶å¯åŠ¨å°è½¦æ¨¡å‹ï¼š**
    ```bash
    source ~/self-driving-my/ros_ws/devel/setup.bash
    roslaunch car_model spawn_car.launch
    ```
      * æ­¤æ—¶ï¼Œå°è½¦æ¨¡å‹ï¼ˆåŒ…å«è½®å­å’Œè½¬å‘æœºæ„ï¼‰åº”è¯¥å‡ºç°åœ¨ Gazebo ä»¿çœŸç¯å¢ƒä¸­ã€‚åŒæ—¶ï¼Œåœ¨ç»ˆç«¯ä¸­å¯ä»¥çœ‹åˆ°æ§åˆ¶å™¨ç®¡ç†å™¨ï¼ˆcontroller\_managerï¼‰æˆåŠŸå¯åŠ¨äº†å„ä¸ªæ§åˆ¶å™¨ã€‚

## 3. éªŒè¯ ROS Topic æ§åˆ¶å™¨

1.  **æ‰“å¼€ç¬¬ä¸‰ä¸ªç»ˆç«¯ï¼ŒSource å·¥ä½œç©ºé—´å¹¶æŸ¥çœ‹ ROS Topicsï¼š**

    ```bash
    source ~/self-driving-my/ros_ws/devel/setup.bash
    rostopic list
    ```

2.  **æµ‹è¯•å‰è½®è½¬å‘æ§åˆ¶ï¼ˆPosition Controllerï¼‰ï¼š**

      * **æ§åˆ¶å³å‰è½®è½¬å‘ï¼š**
        ```bash
        rostopic pub /smart/front_right_steering_position_controller/command std_msgs/Float64 "data: 0.5" 
        ```
        *(0.5 å¼§åº¦/radï¼Œè§‚å¯Ÿå³å‰è½®è½¬å‘ã€‚)*
      * **æ§åˆ¶å·¦å‰è½®è½¬å‘ï¼š**
        ```bash
        rostopic pub /smart/front_left_steering_position_controller/command std_msgs/Float64 "data: -0.5"
        ```
        *(-0.5 å¼§åº¦/radï¼Œè§‚å¯Ÿå·¦å‰è½®è½¬å‘ã€‚)*
      * **å›æ­£ï¼š**
        ```bash
        rostopic pub /smart/front_right_steering_position_controller/command std_msgs/Float64 "data: 0.0" 
        rostopic pub /smart/front_left_steering_position_controller/command std_msgs/Float64 "data: 0.0" 
        ```

3.  **æµ‹è¯•åè½®é©±åŠ¨æ§åˆ¶ï¼ˆVelocity Controllerï¼‰ï¼š**

      * **è®¾ç½®åè½®é€Ÿåº¦ï¼ˆå‰è¿›ï¼‰ï¼š**
        ```bash
        rostopic pub /smart/rear_right_velocity_controller/command std_msgs/Float64 "data: 1.0"
        rostopic pub /smart/rear_left_velocity_controller/command std_msgs/Float64 "data: 1.0"
        ```
        *(1.0 rad/sï¼Œè§‚å¯Ÿå°è½¦å‘å‰è¡Œé©¶ã€‚)*
      * **åœæ­¢å°è½¦ï¼š**
        ```bash
        rostopic pub /smart/rear_right_velocity_controller/command std_msgs/Float64 "data: 0.0"
        rostopic pub /smart/rear_left_velocity_controller/command std_msgs/Float64 "data: 0.0"
        ```

---

## 4. ROS Topic è¯¦ç»†è¯´æ˜

ä»¥ä¸‹ä»‹ç»ä»¿çœŸä¸­æ¯ä¸ªå…³é”®è¯é¢˜çš„ä½œç”¨ï¼Œå¸®åŠ©æ‚¨ç†è§£æ•´ä¸ªæ§åˆ¶ç³»ç»Ÿçš„æ¶æ„ï¼š

### **ğŸ›ï¸ æ§åˆ¶æŒ‡ä»¤è¯é¢˜ï¼ˆè®¢é˜…ï¼‰**

| è¯é¢˜åç§° | æ¶ˆæ¯ç±»å‹ | ä½œç”¨è¯´æ˜ | ç¤ºä¾‹æ•°æ® |
|----------|----------|----------|----------|
| `/smart/front_left_steering_position_controller/command` | `std_msgs/Float64` | **å·¦å‰è½®è½¬å‘è§’åº¦æŒ‡ä»¤**ï¼ˆå¼§åº¦ï¼‰<br>å‘å¸ƒç›®æ ‡è½¬å‘è§’ï¼ŒPIDæ§åˆ¶å™¨ä¼šé©±åŠ¨å…³èŠ‚åˆ°è¾¾è¯¥ä½ç½® | `0.5` (çº¦28.6Â°å‘å³è½¬) |
| `/smart/front_right_steering_position_controller/command` | `std_msgs/Float64` | **å³å‰è½®è½¬å‘è§’åº¦æŒ‡ä»¤**ï¼ˆå¼§åº¦ï¼‰<br>ç‹¬ç«‹æ§åˆ¶å³ä¾§è½¬å‘ï¼Œå®ç°é˜¿å…‹æ›¼å‡ ä½• | `-0.5` (çº¦28.6Â°å‘å·¦è½¬) |
| `/smart/rear_left_velocity_controller/command` | `std_msgs/Float64` | **å·¦åè½®é€Ÿåº¦æŒ‡ä»¤**ï¼ˆrad/sï¼‰<br>æ­£æ•°å‰è¿›ï¼Œè´Ÿæ•°åé€€ï¼Œæ§åˆ¶è½¦è½®è½¬åŠ¨è§’é€Ÿåº¦ | `3.0` (å‘å‰è½¬åŠ¨) |
| `/smart/rear_right_velocity_controller/command` | `std_msgs/Float64` | **å³åè½®é€Ÿåº¦æŒ‡ä»¤**ï¼ˆrad/sï¼‰<br>ä¸å·¦è½®é…åˆå®ç°å·®é€Ÿé©±åŠ¨ | `3.0` (å‘å‰è½¬åŠ¨) |

### **ğŸ“Š çŠ¶æ€åé¦ˆè¯é¢˜ï¼ˆå‘å¸ƒï¼‰**

| è¯é¢˜åç§° | æ¶ˆæ¯ç±»å‹ | ä½œç”¨è¯´æ˜ | æŸ¥çœ‹å‘½ä»¤ |
|----------|----------|----------|----------|
| `/smart/front_left_steering_position_controller/state` | `control_msgs/JointControllerState` | **å·¦è½¬å‘æ§åˆ¶å™¨å®æ—¶çŠ¶æ€**<br>åŒ…å«ï¼šå½“å‰è§’åº¦ã€ç›®æ ‡è§’åº¦ã€è¯¯å·®ã€PIDè¾“å‡ºç­‰è°ƒè¯•ä¿¡æ¯ | `rostopic echo /smart/front_left_steering_position_controller/state` |
| `/smart/front_right_steering_position_controller/state` | `control_msgs/JointControllerState` | **å³è½¬å‘æ§åˆ¶å™¨å®æ—¶çŠ¶æ€**<br>ç”¨äºç›‘æ§PIDæ§åˆ¶å™¨æ€§èƒ½ï¼Œè°ƒå‚æ—¶å¿…å¤‡ | `rostopic echo /smart/front_right_steering_position_controller/state` |
| `/smart/joint_states` | `sensor_msgs/JointState` | **æ‰€æœ‰å…³èŠ‚çŠ¶æ€æ±‡æ€»**<br>åŒ…å«4ä¸ªè½¦è½®çš„ä½ç½®ã€é€Ÿåº¦ã€åŠ›çŸ©ï¼Œæ˜¯æœºå™¨äººæ ¸å¿ƒçŠ¶æ€è¯é¢˜ | `rostopic echo /smart/joint_states` |

### **âš™ï¸ å‚æ•°é…ç½®è¯é¢˜ï¼ˆæœåŠ¡ï¼‰**

| è¯é¢˜åç§° | æ¶ˆæ¯ç±»å‹ | ä½œç”¨è¯´æ˜ | ä½¿ç”¨åœºæ™¯ |
|----------|----------|----------|----------|
| `/smart/front_left_steering_position_controller/pid/parameter_descriptions` | `dynamic_reconfigure/ConfigDescription` | **PIDå‚æ•°æè¿°**<br>å‘å¸ƒPIDå‚æ•°çš„å¯è°ƒèŒƒå›´ã€ç±»å‹ç­‰å…ƒä¿¡æ¯ | æŸ¥çœ‹å¯è°ƒå‚æ•°è¯¦æƒ… |
| `/smart/front_left_steering_position_controller/pid/parameter_updates` | `dynamic_reconfigure/Config` | **PIDå‚æ•°æ›´æ–°åé¦ˆ**<br>å½“å‚æ•°è¢«åŠ¨æ€ä¿®æ”¹æ—¶ï¼Œåœ¨æ­¤å‘å¸ƒæ–°å€¼ | ç¡®è®¤å‚æ•°ä¿®æ”¹ç”Ÿæ•ˆ |
| `/smart/front_right_steering_position_controller/pid/parameter_descriptions` | `dynamic_reconfigure/ConfigDescription` | **å³è½¬å‘PIDå‚æ•°æè¿°** | æŸ¥çœ‹å¯è°ƒå‚æ•°è¯¦æƒ… |
| `/smart/front_right_steering_position_controller/pid/parameter_updates` | `dynamic_reconfigure/Config` | **å³è½¬å‘PIDå‚æ•°æ›´æ–°åé¦ˆ** | ç¡®è®¤å‚æ•°ä¿®æ”¹ç”Ÿæ•ˆ |

### **ğŸŒ TF å˜æ¢è¯é¢˜ï¼ˆå‘å¸ƒï¼‰**

| è¯é¢˜åç§° | æ¶ˆæ¯ç±»å‹ | ä½œç”¨è¯´æ˜ |
|----------|----------|----------|
| `/tf` | `tf/tfMessage` | **åŠ¨æ€åæ ‡å˜æ¢**<br>å®æ—¶å‘å¸ƒè½¦è½®ã€åº•ç›˜ç­‰éƒ¨ä»¶çš„ä½å§¿å˜æ¢ï¼Œç”¨äºRVizæ˜¾ç¤ºå’Œå®šä½ |
| `/tf_static` | `tf/tfMessage` | **é™æ€åæ ‡å˜æ¢**<br>å‘å¸ƒå›ºå®šçš„åæ ‡ç³»å…³ç³»ï¼ˆå¦‚base_linkåˆ°laser_linkï¼‰ï¼Œåªå‘é€ä¸€æ¬¡ |

### **ğŸ’¡ å®é™…åº”ç”¨ç¤ºä¾‹**

```bash
# 1. å®æ—¶ç›‘æ§è½¦è½®è½¬å‘çŠ¶æ€ï¼ˆæ–°å¼€ç»ˆç«¯ï¼‰
rostopic echo /smart/front_left_steering_position_controller/state

# 2. æŸ¥çœ‹æ‰€æœ‰å…³èŠ‚çš„å®æ—¶è§’åº¦å’Œé€Ÿåº¦
rostopic echo /smart/joint_states

# 3. åŠ¨æ€è°ƒæ•´PIDå‚æ•°ï¼ˆéœ€è¦å®‰è£…rqt_reconfigureï¼‰
rosrun rqt_reconfigure rqt_reconfigure
# ç„¶ååœ¨GUIä¸­é€‰æ‹© /smart/front_left_steering_position_controller/pid

# 4. åœ¨RVizä¸­æŸ¥çœ‹TFå˜æ¢
rosrun rviz rviz
# æ·»åŠ TFæ˜¾ç¤ºæ’ä»¶ï¼Œå³å¯çœ‹åˆ°å°è½¦å„éƒ¨ä»¶åæ ‡ç³»
```

---

## **å¯¹æ¯”ä¹‹å‰çš„åŒºåˆ«**

`control.launch`: å¯åŠ¨æ§åˆ¶å™¨ä¸å…³èŠ‚å‘å¸ƒå™¨  
`spawn_car`ï¼šåŠ è½½å°è½¦ä¹‹å¤–ï¼Œé¢å¤–åŠ è½½`control.launch`  
`smart.xacro`: é¢å¤–ç»™å‡ºè½¦è½®æ§åˆ¶æ–¹æ³•;è½®èƒä¸åœ°é¢äº¤äº’ç‰¹æ€§;gazeboæ’ä»¶


## **å·®å¼‚å¯¹æ¯”è¡¨**

| **æ¨¡å—** | **File 1 (å®Œæ•´ç‰ˆ)** | **File 2 (ç®€åŒ–ç‰ˆ)** | **ä½œç”¨å·®å¼‚** |
|----------|---------------------|---------------------|--------------|
| **Transmission** | âœ… **åŒ…å«4ä¸ª**ï¼ˆå‰åè½®é©±åŠ¨+è½¬å‘ï¼‰ | âŒ **å®Œå…¨ç¼ºå¤±** | èƒ½å¦è¢« ROS æ§åˆ¶ |
| **Friction å‚æ•°** | âœ… **åŒ…å«4ä¸ª wheel çš„æ‘©æ“¦è®¾ç½®** | âŒ **å®Œå…¨ç¼ºå¤±** | Gazebo ç‰©ç†ä»¿çœŸå‡†ç¡®æ€§ |
| **Gazebo æ’ä»¶** | âœ… **2ä¸ªæ’ä»¶**ï¼ˆæ§åˆ¶+çŠ¶æ€å‘å¸ƒï¼‰ | âŒ **å®Œå…¨ç¼ºå¤±** | ä¸ ROS çš„äº¤äº’èƒ½åŠ› |
| **æ–‡ä»¶å¤§å°** | çº¦ **320 è¡Œ** | çº¦ **220 è¡Œ** | åŠŸèƒ½å®Œæ•´æ€§ |

---

## **è¯¦ç»†å·®å¼‚è§£æ**

### **1ï¸âƒ£ Transmission æ¨¡å—ï¼ˆFile 1 ç‹¬æœ‰ï¼‰**

```xml
<!-- åè½®é©±åŠ¨ç”µæœº -->
<transmission name="tran1">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="rear_right_wheel_joint">
    <hardwareInterface>hardware_interface/VelocityJointInterface</hardwareInterface>
  </joint>
  <actuator name="motor1">
    <hardwareInterface>hardware_interface/VelocityJointInterface</hardwareInterface>
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>
```

**ä½œç”¨**ï¼šå‘Šè¯‰ ROS *å¦‚ä½•æ§åˆ¶* è½¦è½®ï¼Œç¼ºå°‘å®ƒåˆ™æ— æ³•åœ¨ ROS ä¸­å‘é€é€Ÿåº¦æŒ‡ä»¤ã€‚

---

### **2ï¸âƒ£ Friction å‚æ•°ï¼ˆFile 1 ç‹¬æœ‰ï¼‰**

```xml
<gazebo reference="rear_right_wheel_link">
  <mu1>10000000</mu1>  <!-- æ‘©æ“¦ç³»æ•° -->
  <mu2>10000000</mu2>
  <kp>10000000</kp>   <!-- æ¥è§¦åˆšåº¦ -->
  <kd>1</kd>          <!-- æ¥è§¦é˜»å°¼ -->
</gazebo>
```

**ä½œç”¨**ï¼šå®šä¹‰è½®èƒä¸åœ°é¢çš„ç‰©ç†äº¤äº’ç‰¹æ€§ï¼Œç¼ºå°‘åˆ™è½¦è¾†å¯èƒ½æ‰“æ»‘æˆ–è¡Œä¸ºå¼‚å¸¸ã€‚

---

### **3ï¸âƒ£ Gazebo æ’ä»¶ï¼ˆFile 1 ç‹¬æœ‰ï¼‰**

```xml
<!-- æ ¸å¿ƒæ§åˆ¶æ’ä»¶ -->
<gazebo>
  <plugin name="gazebo_ros_control" filename="libgazebo_ros_control.so">
    <robotNamespace>/smart</robotNamespace>
    <robotParam>robot_description</robotParam>
  </plugin>
</gazebo>

<!-- å…³èŠ‚çŠ¶æ€å‘å¸ƒæ’ä»¶ -->
<gazebo>
  <plugin name="joint_state_publisher" filename="libgazebo_ros_joint_state_publisher.so">
    <jointName>rear_left_wheel_joint, ...</jointName>
    <updateRate>50.0</updateRate>
  </plugin>
</gazebo>
```

**ä½œç”¨**ï¼šè®© Gazebo ä¸ ROS é€šä¿¡ï¼Œç¼ºå°‘åˆ™ `rostopic echo /smart/joint_states` çœ‹ä¸åˆ°æ•°æ®ã€‚

---

### **è¿è¡Œæ•ˆæœå·®å¼‚**

| **åœºæ™¯** | **File 1** | **File 2** |
|----------|------------|------------|
| **å¯åŠ¨ä»¿çœŸ** | âœ… æ¨¡å‹+æ§åˆ¶å®Œæ•´åŠ è½½ | âœ… ä»…é™æ€æ¨¡å‹æ˜¾ç¤º |
| **å‘é€é€Ÿåº¦æŒ‡ä»¤** | âœ… è½¦è¾†å¯ä»¥ç§»åŠ¨ | âŒ è½¦è½®æ— å“åº” |
| **è¯»å–è½®é€Ÿ** | âœ… `/smart/joint_states` æœ‰æ•°æ® | âŒ `/smart/joint_states` ä¸ºç©º |
| **è½¬å‘æ§åˆ¶** | âœ… å¯æ§åˆ¶è½¬å‘è§’ | âŒ è½¬å‘å…³èŠ‚æ— é©±åŠ¨ |
| **ç‰©ç†è¡Œä¸º** | âœ… è½®èƒæ‘©æ“¦çœŸå® | âš ï¸ ä½¿ç”¨ Gazebo é»˜è®¤å€¼ |



**ç»“è®º**ï¼šä¸¤ä¸ªæ–‡ä»¶çš„å”¯ä¸€åŒºåˆ«åœ¨äº **ROS æ§åˆ¶æ¥å£çš„å®Œæ•´æ€§**ï¼ŒFile 1 æ˜¯ç”¨äºçœŸå®ä»¿çœŸçš„ç”Ÿäº§ç‰ˆæœ¬ï¼ŒFile 2 æ˜¯ç”¨äºå¿«é€ŸéªŒè¯çš„ç®€åŒ–ç‰ˆæœ¬ã€‚