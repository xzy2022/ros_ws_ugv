这里整理了 `control_experiments` 实验模块的用法，用于对不同路径跟随算法（目前支持 Stanley / Pure Pursuit）进行一键实验、日志采集、指标计算与可视化。

## 1. 快速一键启动（推荐）
```bash
roslaunch control_experiments full_stack_experiment.launch \
    algorithm:=stanley duration:=60 start_gazebo:=true start_rviz:=false
```
- 自动启动 Gazebo 空世界、车辆模型与路径节点、可选 RViz，再启动实验节点。
- 常用参数：`algorithm`（stanley/pure_persuit）、`duration`、`start_gazebo`、`start_rviz`、`require_rviz`。

## 2. 只运行实验节点（环境已手动启动时）
```bash
roslaunch control_experiments experiment.launch algorithm:=stanley duration:=45
```
若只想分析已有数据而不重新采集：
```bash
roslaunch control_experiments experiment.launch \
    run_collection:=false start_controller:=false \
    existing_data_path:=/absolute/path/to/data.txt
```

## 3. 可选流程开关
- `start_controller`：是否自动启动对应算法的 roslaunch。
- `run_collection`：是否采集数据到新的 `results/<timestamp>/data.txt`。
- `run_metrics`：是否计算指标写入 `summary.txt`。
- `run_plots`：是否生成 PNG 图（路径、CTE、方向误差(°)、速度）。
- `run_index`：是否在 `results/summary.txt` 追加索引。
- `existing_data_path`：复用已有数据文件时填写。

## 4. 输出结果
- 采集数据：`src/control_experiments/results/<timestamp>/data.txt`
- 指标：`.../summary.txt`
- 图像：`.../path.png`, `cte.png`, `heading_error.png` (角度), `speed.png`
- 汇总索引：`src/control_experiments/results/summary.txt`

## 5. 运行前检查逻辑
实验节点会自动反复检查以下前置条件，任何未就绪会阻止实验并打印 WARN：
- Gazebo 是否在跑（/gazebo/ 相关话题）
- 车辆模型基础话题：`/smart/rear_pose`、`/smart/velocity`
- 全局路径：`/base_waypoints` 或 `/lane`
- 局部路径：`/final_waypoints`
- RViz（如果 `require_rviz:=true` 则必须存在）
