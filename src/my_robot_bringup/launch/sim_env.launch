<?xml version="1.0"?>
<launch>
    <!-- High level toggles -->
    <arg name="robot_name" default="smart" />
    <arg name="start_gazebo" default="true" />
    <arg name="start_rviz" default="true" />
    <arg name="paused" default="false" />
    <arg name="use_sim_time" default="true" />
    <arg name="world_file" default="$(find gazebo_ros)/worlds/empty.world" />
    <arg name="rviz_config" default="$(find my_robot_bringup)/rviz/smart.rviz" />

    <!-- Load shared parameters once -->
    <rosparam command="load" file="$(find my_robot_bringup)/config/global_params.yaml" ns="$(arg robot_name)" />
    <param name="robot_name" value="$(arg robot_name)" />
    <param name="use_sim_time" value="$(arg use_sim_time)" />

    <!-- Upload robot description for downstream nodes -->
    <include file="$(find my_robot_description)/launch/upload_description.launch">
        <arg name="robot_name" value="$(arg robot_name)" />
    </include>

    <group if="$(arg start_gazebo)">
        <include file="$(find my_robot_gazebo)/launch/sim.launch">
            <arg name="world_file" value="$(arg world_file)" />
            <arg name="paused" value="$(arg paused)" />
            <arg name="robot_name" value="$(arg robot_name)" />
        </include>

        <include file="$(find my_robot_control)/launch/controllers.launch">
            <arg name="robot_name" value="$(arg robot_name)" />
        </include>
    </group>

    <group if="$(arg start_rviz)">
        <node pkg="rviz" type="rviz" name="rviz" args="-d $(arg rviz_config)" output="screen" />
    </group>
</launch>
