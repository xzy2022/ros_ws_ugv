# ğŸï¸ æ•™ç¨‹å¤ç°æ­¥éª¤ï¼šç”¨ ROS Topic æ§åˆ¶è½¦è½®

## 1\. å‡†å¤‡å·¥ä½œ

  * **å…‹éš†æˆ–ä¸‹è½½ä»£ç ï¼š**

      * è·å–æœ¬æ•™ç¨‹ç›¸å…³çš„ä»£ç ä»“åº“ï¼ˆè§†é¢‘ä¸­æåˆ°çš„æ˜¯ `cotberry/self-driving-vehicle-101`ï¼‰ã€‚
      * ç¡®ä¿ä½ çš„å·¥ä½œç©ºé—´ï¼ˆå¦‚ `catkin_ws`ï¼‰ä¸­åŒ…å«æ‰€éœ€çš„ROSåŒ…ã€‚

  * **æ›´æ–°å·¥ä½œç©ºé—´æ–‡ä»¶ï¼š**

      * åœ¨ä½ çš„å°è½¦æ¨¡å‹åŒ…ï¼ˆ`car_model`ï¼‰ä¸­ï¼Œç”¨æ•™ç¨‹æä¾›çš„**07 æ–‡ä»¶å¤¹**ä¸­çš„æ–‡ä»¶è¦†ç›–åŸæœ‰çš„æ–‡ä»¶ï¼ˆåŒ…æ‹¬ `config`, `launch`, `urdf` ç­‰æ–‡ä»¶å¤¹ï¼‰ã€‚
      * **é‡è¦æ–‡ä»¶ä¿®æ”¹ï¼ˆè§†é¢‘ä¸­å¼ºè°ƒçš„ï¼‰ï¼š**
          * **`urdf/smart.urdf.xacro` (URDF æ–‡ä»¶):**
              * **æ·»åŠ  `transmission` æ¨¡å—:** ä¸ºæ¯ä¸ªè½®å­çš„ jointï¼ˆåè½®çš„é€Ÿåº¦ jointï¼Œå‰è½®çš„è½¬å‘ jointï¼‰æ·»åŠ  `transmission` æ ‡ç­¾ï¼Œå®šä¹‰å…¶ç±»å‹ï¼ˆå¦‚ `hardwareInterface/VelocityJointInterface` æˆ– `hardwareInterface/EffortJointInterface`ï¼‰å’Œæ‰§è¡Œå™¨ï¼ˆActuatorï¼‰ã€‚
              * **æ·»åŠ  Gazebo Plugins:** æ·»åŠ  `gazebo_ros_control` æ’ä»¶å’Œ `robot_state_publisher` æ’ä»¶ï¼Œç”¨äºè¿æ¥Gazeboä»¿çœŸå’ŒROSæ§åˆ¶å™¨ã€‚
              * **æ·»åŠ æ‘©æ“¦åŠ›ï¼ˆFriction Parametersï¼‰:** åœ¨ Gazebo ç›¸å…³çš„ link å±æ€§ä¸­ä¸ºè½¦è½®æ·»åŠ æ‘©æ“¦åŠ›å‚æ•°ä»¥å¢åŠ ä»¿çœŸçœŸå®æ€§ã€‚
          * **`config/smart_control.yaml` (æ§åˆ¶å™¨é…ç½®):**
              * å®šä¹‰å¹¶é…ç½®æ‰€éœ€çš„ **ROS Controllers**ï¼ŒåŒ…æ‹¬ï¼š
                  * `JointStateController` (è”åˆçŠ¶æ€æ§åˆ¶å™¨)
                  * `VelocityControllers` (åè½®é€Ÿåº¦æ§åˆ¶å™¨, `rear_right_wheel_joint`, `rear_left_wheel_joint`)
                  * `EffortControllers/JointPositionController` (å‰è½®è½¬å‘ä½ç½®æ§åˆ¶å™¨, `front_right_steering_joint`, `front_left_steering_joint`)
              * ä¸ºæ¯ä¸ªæ§åˆ¶å™¨è®¾ç½® **PID å‚æ•°**ã€‚
          * **`launch/control.launch` (å¯åŠ¨æ–‡ä»¶):**
              * åŠ è½½ `smart_control.yaml` é…ç½®æ–‡ä»¶åˆ°ROSå‚æ•°æœåŠ¡å™¨ã€‚
              * ä½¿ç”¨ `controller_manager` èŠ‚ç‚¹å¯åŠ¨ï¼ˆSpawnï¼‰å‰é¢é…ç½®çš„å„ä¸ªæ§åˆ¶å™¨ã€‚

## 2\. å¯åŠ¨ Gazebo ä»¿çœŸ

1.  **æ‰“å¼€ç¬¬ä¸€ä¸ªç»ˆç«¯ï¼ŒSource å·¥ä½œç©ºé—´å¹¶å¯åŠ¨ Gazebo ç©ºä¸–ç•Œï¼š**
    ```bash
    source ~/catkin_ws/devel/setup.bash
    roslaunch gazebo_ros empty_world.launch
    ```
2.  **æ‰“å¼€ç¬¬äºŒä¸ªç»ˆç«¯ï¼ŒSource å·¥ä½œç©ºé—´å¹¶å¯åŠ¨å°è½¦æ¨¡å‹ï¼š**
    ```bash
    source ~/catkin_ws/devel/setup.bash
    roslaunch car_model spawn_car.launch
    ```
      * æ­¤æ—¶ï¼Œå°è½¦æ¨¡å‹ï¼ˆåŒ…å«è½®å­å’Œè½¬å‘æœºæ„ï¼‰åº”è¯¥å‡ºç°åœ¨ Gazebo ä»¿çœŸç¯å¢ƒä¸­ã€‚åŒæ—¶ï¼Œåœ¨ç»ˆç«¯ä¸­å¯ä»¥çœ‹åˆ°æ§åˆ¶å™¨ç®¡ç†å™¨ï¼ˆcontroller\_managerï¼‰æˆåŠŸå¯åŠ¨äº†å„ä¸ªæ§åˆ¶å™¨ã€‚

## 3\. éªŒè¯ ROS Topic æ§åˆ¶å™¨

1.  **æ‰“å¼€ç¬¬ä¸‰ä¸ªç»ˆç«¯ï¼ŒSource å·¥ä½œç©ºé—´å¹¶æŸ¥çœ‹ ROS Topicsï¼š**

    ```bash
    source ~/catkin_ws/devel/setup.bash
    rostopic list
    ```

      * **å…³é”®æ–° Topic åˆ—è¡¨:** ä½ åº”è¯¥èƒ½çœ‹åˆ°ç”±æ§åˆ¶å™¨ç®¡ç†å™¨åˆ›å»ºçš„ã€ç”¨äºæ§åˆ¶è½¦è½®çš„æ–° Topicsï¼Œä¾‹å¦‚ï¼š
          * `/rear/left_velocity_controller/command`
          * `/rear/right_velocity_controller/command`
          * `/front/left_steering_position_controller/command`
          * `/front/right_steering_position_controller/command`

2.  **æµ‹è¯•å‰è½®è½¬å‘æ§åˆ¶ï¼ˆPosition Controllerï¼‰ï¼š**

      * **æ§åˆ¶å³å‰è½®è½¬å‘ï¼š**
        ```bash
        rostopic pub /front/right_steering_position_controller/command std_msgs/Float64 "data: 0.5" 
        ```
        *(0.5 å¼§åº¦/radï¼Œè§‚å¯Ÿå³å‰è½®è½¬å‘ã€‚)*
      * **æ§åˆ¶å·¦å‰è½®è½¬å‘ï¼š**
        ```bash
        rostopic pub /front/left_steering_position_controller/command std_msgs/Float64 "data: -0.5"
        ```
        *(-0.5 å¼§åº¦/radï¼Œè§‚å¯Ÿå·¦å‰è½®è½¬å‘ã€‚)*
      * **å›æ­£ï¼š**
        ```bash
        rostopic pub /front/right_steering_position_controller/command std_msgs/Float64 "data: 0.0" 
        rostopic pub /front/left_steering_position_controller/command std_msgs/Float64 "data: 0.0" 
        ```

3.  **æµ‹è¯•åè½®é©±åŠ¨æ§åˆ¶ï¼ˆVelocity Controllerï¼‰ï¼š**

      * **è®¾ç½®åè½®é€Ÿåº¦ï¼ˆå‰è¿›ï¼‰ï¼š**
        ```bash
        rostopic pub /rear/right_velocity_controller/command std_msgs/Float64 "data: 1.0"
        rostopic pub /rear/left_velocity_controller/command std_msgs/Float64 "data: 1.0"
        ```
        *(1.0 rad/sï¼Œè§‚å¯Ÿå°è½¦å‘å‰è¡Œé©¶ã€‚)*
      * **åœæ­¢å°è½¦ï¼š**
        ```bash
        rostopic pub /rear/right_velocity_controller/command std_msgs/Float64 "data: 0.0"
        rostopic pub /rear/left_velocity_controller/command std_msgs/Float64 "data: 0.0"
        ```

# å¯¹æ¯”ä¹‹å‰çš„åŒºåˆ«
`control.launch`: å¯åŠ¨æ§åˆ¶å™¨ä¸å…³èŠ‚å‘å¸ƒå™¨
`spawn_car`ï¼šåŠ è½½å°è½¦ä¹‹å¤–ï¼Œé¢å¤–åŠ è½½`control.launch`
`smart.xacro`: é¢å¤–ç»™å‡ºè½¦è½®æ§åˆ¶æ–¹æ³•;è½®èƒä¸åœ°é¢äº¤äº’ç‰¹æ€§;gazeboæ’ä»¶


## **å·®å¼‚å¯¹æ¯”è¡¨**

| **æ¨¡å—** | **File 1 (å®Œæ•´ç‰ˆ)** | **File 2 (ç®€åŒ–ç‰ˆ)** | **ä½œç”¨å·®å¼‚** |
|----------|---------------------|---------------------|--------------|
| **Transmission** | âœ… **åŒ…å«4ä¸ª**ï¼ˆå‰åè½®é©±åŠ¨+è½¬å‘ï¼‰ | âŒ **å®Œå…¨ç¼ºå¤±** | èƒ½å¦è¢« ROS æ§åˆ¶ |
| **Friction å‚æ•°** | âœ… **åŒ…å«4ä¸ª wheel çš„æ‘©æ“¦è®¾ç½®** | âŒ **å®Œå…¨ç¼ºå¤±** | Gazebo ç‰©ç†ä»¿çœŸå‡†ç¡®æ€§ |
| **Gazebo æ’ä»¶** | âœ… **2ä¸ªæ’ä»¶**ï¼ˆæ§åˆ¶+çŠ¶æ€å‘å¸ƒï¼‰ | âŒ **å®Œå…¨ç¼ºå¤±** | ä¸ ROS çš„äº¤äº’èƒ½åŠ› |
| **æ–‡ä»¶å¤§å°** | çº¦ **320 è¡Œ** | çº¦ **220 è¡Œ** | åŠŸèƒ½å®Œæ•´æ€§ |

---

## **è¯¦ç»†å·®å¼‚è§£æ**

### **1ï¸âƒ£ Transmission æ¨¡å—ï¼ˆFile 1 ç‹¬æœ‰ï¼‰**

```xml
<!-- åè½®é©±åŠ¨ç”µæœº -->
<transmission name="tran1">
  <type>transmission_interface/SimpleTransmission</type>
  <joint name="rear_right_wheel_joint">
    <hardwareInterface>hardware_interface/VelocityJointInterface</hardwareInterface>
  </joint>
  <actuator name="motor1">
    <hardwareInterface>hardware_interface/VelocityJointInterface</hardwareInterface>
    <mechanicalReduction>1</mechanicalReduction>
  </actuator>
</transmission>
```

**ä½œç”¨**ï¼šå‘Šè¯‰ ROS *å¦‚ä½•æ§åˆ¶* è½¦è½®ï¼Œç¼ºå°‘å®ƒåˆ™æ— æ³•åœ¨ ROS ä¸­å‘é€é€Ÿåº¦æŒ‡ä»¤ã€‚

---

### **2ï¸âƒ£ Friction å‚æ•°ï¼ˆFile 1 ç‹¬æœ‰ï¼‰**

```xml
<gazebo reference="rear_right_wheel_link">
  <mu1>10000000</mu1>  <!-- æ‘©æ“¦ç³»æ•° -->
  <mu2>10000000</mu2>
  <kp>10000000</kp>   <!-- æ¥è§¦åˆšåº¦ -->
  <kd>1</kd>          <!-- æ¥è§¦é˜»å°¼ -->
</gazebo>
```

**ä½œç”¨**ï¼šå®šä¹‰è½®èƒä¸åœ°é¢çš„ç‰©ç†äº¤äº’ç‰¹æ€§ï¼Œç¼ºå°‘åˆ™è½¦è¾†å¯èƒ½æ‰“æ»‘æˆ–è¡Œä¸ºå¼‚å¸¸ã€‚

---

### **3ï¸âƒ£ Gazebo æ’ä»¶ï¼ˆFile 1 ç‹¬æœ‰ï¼‰**

```xml
<!-- æ ¸å¿ƒæ§åˆ¶æ’ä»¶ -->
<gazebo>
  <plugin name="gazebo_ros_control" filename="libgazebo_ros_control.so">
    <robotNamespace>/smart</robotNamespace>
    <robotParam>robot_description</robotParam>
  </plugin>
</gazebo>

<!-- å…³èŠ‚çŠ¶æ€å‘å¸ƒæ’ä»¶ -->
<gazebo>
  <plugin name="joint_state_publisher" filename="libgazebo_ros_joint_state_publisher.so">
    <jointName>rear_left_wheel_joint, ...</jointName>
    <updateRate>50.0</updateRate>
  </plugin>
</gazebo>
```

**ä½œç”¨**ï¼šè®© Gazebo ä¸ ROS é€šä¿¡ï¼Œç¼ºå°‘åˆ™ `rostopic echo /joint_states` çœ‹ä¸åˆ°æ•°æ®ã€‚

---

### **è¿è¡Œæ•ˆæœå·®å¼‚**

| **åœºæ™¯** | **File 1** | **File 2** |
|----------|------------|------------|
| **å¯åŠ¨ä»¿çœŸ** | âœ… æ¨¡å‹+æ§åˆ¶å®Œæ•´åŠ è½½ | âœ… ä»…é™æ€æ¨¡å‹æ˜¾ç¤º |
| **å‘é€é€Ÿåº¦æŒ‡ä»¤** | âœ… è½¦è¾†å¯ä»¥ç§»åŠ¨ | âŒ è½¦è½®æ— å“åº” |
| **è¯»å–è½®é€Ÿ** | âœ… `/joint_states` æœ‰æ•°æ® | âŒ `/joint_states` ä¸ºç©º |
| **è½¬å‘æ§åˆ¶** | âœ… å¯æ§åˆ¶è½¬å‘è§’ | âŒ è½¬å‘å…³èŠ‚æ— é©±åŠ¨ |
| **ç‰©ç†è¡Œä¸º** | âœ… è½®èƒæ‘©æ“¦çœŸå® | âš ï¸ ä½¿ç”¨ Gazebo é»˜è®¤å€¼ |



**ç»“è®º**ï¼šä¸¤ä¸ªæ–‡ä»¶çš„å”¯ä¸€åŒºåˆ«åœ¨äº **ROS æ§åˆ¶æ¥å£çš„å®Œæ•´æ€§**ï¼ŒFile 1 æ˜¯ç”¨äºçœŸå®ä»¿çœŸçš„ç”Ÿäº§ç‰ˆæœ¬ï¼ŒFile 2 æ˜¯ç”¨äºå¿«é€ŸéªŒè¯çš„ç®€åŒ–ç‰ˆæœ¬ã€‚
